<%
var currentPost = get_posts({
    query: { 
        name: page.name
    },
    count: 1
});

var pageCategory;

page.categories.each(function(cat) { 

    pageCategory = cat.name; 

});

%>

<section class="api">

    <nav class="apinav">
    <% site.categories.each(function(category) { %>
        
        <h3><a href="#" class="icon-folder-close-alt<% if (pageCategory === category.name) { %> active<% } %>" data-open="<%- category.name %>"><%- category.name %></a></h3>
        <div class="commands <%- category.name %><% if (pageCategory === category.name) { %> active<% } %>">
        <%
        var api = get_posts({
            query: { 
                categories: category.name
            },
            count: 999
        });

        api.forEach(function(post){ %>

            <a href="/api/<%- category.name %>/<%- post.name %>"<% if (page.name === post.name) { %> class="active"<% } %>><%- post.name %></a>

        <% }) %>
        </div>

    <% }) %>
    </nav>


    <article class="doc">
        <%
        var dir = pageCategory === 'protocol' ? 'protocol' : 'commands';
        %>
        <a href="https://github.com/camme/webdriverjs/blob/master/lib/<%- dir %>/<%- page.name %>.js" target="_blank" class="btn icon-search source">View Source</a>
        <a href="https://github.com/camme/webdriverjs/edit/master/lib/<%- dir %>/<%- page.name %>.js" target="_blank" class="btn icon-edit improve">Improve this doc</a>
        <%- page.content %>
    </article>

</section>